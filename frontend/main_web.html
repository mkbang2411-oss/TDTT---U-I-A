<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>UIA - Find Food Find Us</title>
    <link rel="stylesheet" href="banner.css">
    <link rel="stylesheet" href="button.css">
    <link rel="stylesheet" href="weblogin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"/>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<style>
    .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #333;
        color: #fff;
        padding: 12px 18px;
        border-radius: 10px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
        z-index: 9999;
        font-size: 15px;
    }
    .toast.show {
        opacity: 1;
        transform: translateY(0);
    }
    .toast.success {
        background: #4caf50;
    }
    .toast.error {
        background: #e53935;
    }
    
    /* ·∫®n/hi·ªán ph·∫ßn t·ª≠ theo tr·∫°ng th√°i */
    /* .guest-only { display: block; } */
    .guest-only,
    .user-only { display: none; }
    
    body.logged-in .guest-only { display: none; }
    body.logged-in .user-only { display: block; }
</style>

<body>
    <!-- üîî Toast Notification -->
    <div id="toast" class="toast"></div>

    <header class="banner">
        <div class="background">
            <img src="Picture/background.png" class="bg" alt="UIA Logo">
            <img src="Picture/UIAaa.png" class="uia" alt="UIA">
            
            <!-- N√∫t Account - CH·ªà HI·ªÜN KHI ƒê√É ƒêƒÇNG NH·∫¨P -->
                <div class="user-only">
                    <a href="Account.html" class="account-button">
                        <img src="Picture/user.png" alt="Account">
                    </a>
                </div>
            
            <!-- N√∫t Sign Up/Sign In - CH·ªà HI·ªÜN KHI CH∆ØA ƒêƒÇNG NH·∫¨P -->
                <div class="guest-only">
                    <a href="http://127.0.0.1:8000/accounts/signup" class="button-SignUp">ƒêƒÉng K√≠</a>
                    <a href="http://127.0.0.1:8000/accounts/login" class="button-SignIn">ƒêƒÉng Nh·∫≠p</a>
                </div>
        </div>
    </header>

    <div id="controls">
        <!-- üß≠ THANH NH·∫¨P ƒê·ªäA ƒêI·ªÇM -->
        <div class="gps-box">
            <input id="gpsInput" type="text" placeholder="ƒê·ªãa ƒëi·ªÉm c·ªßa b·∫°n..." autocomplete="off" />
            <button id="gpsLocateBtn" title="D√πng GPS" class="gps-btn">üìç</button>
        </div>

        <!-- üîç THANH T√åM QU√ÅN ƒÇN -->
        <div class="search-row">
            <div class="search-box">
                <input id="query" type="text" placeholder="T√¨m qu√°n ƒÉn..." autocomplete="off" />
                <div id="suggestions" class="suggestions"></div>
            </div>
        </div>

        <!-- Multi-select kh·∫©u v·ªã -->
<div class="flavor-selector" id="flavorSelector">
    <div class="flavor-selector-btn" id="flavorBtn">
        <span class="selected-flavors empty">Kh·∫©u v·ªã</span>
        <span class="arrow">‚ñº</span>
    </div>
    <div class="flavor-dropdown" id="flavorDropdown">
        <div class="flavor-option">
            <input type="checkbox" value="cay" id="flavor-cay">
            <label for="flavor-cay">Cay</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="man" id="flavor-man">
            <label for="flavor-man">M·∫∑n</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="ngot" id="flavor-ngot">
            <label for="flavor-ngot">Ng·ªçt</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="chua" id="flavor-chua">
            <label for="flavor-chua">Chua</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="dang" id="flavor-dang">
            <label for="flavor-dang">ƒê·∫Øng</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="tanh" id="flavor-tanh">
            <label for="flavor-tanh">Tanh</label>
        </div>
        <div class="flavor-option">
            <input type="checkbox" value="thanh" id="flavor-thanh">
            <label for="flavor-thanh">Thanh</label>
        </div>
    </div>
</div>

        <!-- üí∞ BUDGET -->
        <div class="budget-selector">
            <select id="budget">
                <option value="">Ng√¢n s√°ch m·∫∑c ƒë·ªãnh</option>
                <option value="1-100000">1 ‚Äì 100.000 ‚Ç´</option>
                <option value="100000-200000">100.000 ‚Äì 200.000 ‚Ç´</option>
                <option value="200000-300000">200.000 ‚Äì 300.000 ‚Ç´</option>
                <option value="300000-9999999">300.000 ‚Ç´ tr·ªü l√™n</option>
            </select>
        </div>

        <!-- üìè B√ÅN K√çNH -->
        <div class="radius-selector">
            <select id="radius">
                <option value="">B√°n k√≠nh t√¨m ki·∫øm</option>
                <option value="0.5">500 m</option>
                <option value="1">1 km</option>
                <option value="2">2 km</option>
                <option value="3">3 km</option>
                <option value="5">5 km</option>
            </select>
        </div>

        <button id="btnSearch">üîç T√¨m</button>
    </div>

    <div id="sidebar" class="hidden">
        <button id="closeSidebar">√ó</button>
        <div id="sidebar-content"></div>
    </div>

    <div id="map"></div>
    
    <!-- üñºÔ∏è Popup zoom ·∫£nh -->
    <div id="imageModal" class="image-modal">
        <span id="closeModal">&times;</span>
        <img id="modalImg" src="" alt="Zoomed image">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
    <script src="script.js"></script>
    
    <!-- üîê Script ki·ªÉm tra ƒëƒÉng nh·∫≠p -->
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
    
            // L·∫•y c√°c ph·∫ßn t·ª≠ n√∫t
            const guestButtons = document.querySelector('.guest-only');
            const userButton = document.querySelector('.user-only');

            // G·ªçi API tr√™n server Django
            fetch('http://127.0.0.1:8000/api/check-auth/', {
                method: 'GET',
                // B·∫ÆT BU·ªòC: G·ª≠i cookie (session) c√πng v·ªõi y√™u c·∫ßu
                credentials: 'include' 
            })
            .then(response => response.json())
            .then(data => {
                // data s·∫Ω l√†: {is_authenticated: true} ho·∫∑c {is_authenticated: false}
                if (data.is_authenticated) {
                    // ƒê√£ ƒëƒÉng nh·∫≠p
                    if (guestButtons) guestButtons.style.display = 'none'; // ·∫®n n√∫t ƒêƒÉng nh·∫≠p
                    if (userButton) userButton.style.display = 'block';  // Hi·ªán n√∫t Account
                    
                    // T√πy ch·ªçn: Ch√†o m·ª´ng ng∆∞·ªùi d√πng
                    console.log('Ch√†o m·ª´ng, ' + data.username);
                } else {
                    // Ch∆∞a ƒëƒÉng nh·∫≠p
                    if (guestButtons) guestButtons.style.display = 'block'; // Hi·ªán n√∫t ƒêƒÉng nh·∫≠p
                    if (userButton) userButton.style.display = 'none';   // ·∫®n n√∫t Account
                }
            })
            .catch(error => {
                console.error('L·ªói khi ki·ªÉm tra x√°c th·ª±c:', error);
                // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã l√† ch∆∞a ƒëƒÉng nh·∫≠p n·∫øu API l·ªói
                if (guestButtons) guestButtons.style.display = 'block';
                if (userButton) userButton.style.display = 'none';
            });
        });
    </script>
    
    <div id="insert-chatbot-and-map"></div>
</body>
</html>
