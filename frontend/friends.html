HTML_CONTENT = <!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·∫øt b·∫°n - UIAboss</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { color: #667eea; font-size: 28px; }

        .user-select {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-select select {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-home {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
        }

        /* Th·ªëng k√™ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h2 { font-size: 36px; margin-bottom: 10px; }
        .stat-card p { opacity: 0.9; font-size: 14px; }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* User card */
        .user-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .user-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .user-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .user-info h3 { color: #333; margin-bottom: 5px; }
        .user-info p { color: #999; font-size: 14px; }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-secondary { background: #6b7280; color: white; }

        .btn:hover { transform: translateY(-2px); }

        .btn-group { display: flex; gap: 10px; }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-primary { background: #dbeafe; color: #1e40af; }
        .badge-warning { background: #fef3c7; color: #92400e; }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon { font-size: 64px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üë• K·∫øt b·∫°n</h1>
            <div class="user-select">
                <label style="font-weight: 600;">B·∫°n l√†:</label>
                <select id="userSelect" onchange="changeUser()">
                    <option value="">-- Ch·ªçn t√™n c·ªßa b·∫°n --</option>
                </select>
                <a href="/" class="btn-home">üè† Trang ch·ªß</a>
            </div>
        </div>

        <div id="mainContent" style="display: none;">
            <!-- Th·ªëng k√™ -->
            <div class="stats">
                <div class="stat-card">
                    <h2 id="friendsCount">0</h2>
                    <p>B·∫°n b√®</p>
                </div>
                <div class="stat-card">
                    <h2 id="pendingCount">0</h2>
                    <p>L·ªùi m·ªùi nh·∫≠n</p>
                </div>
                <div class="stat-card">
                    <h2 id="sentCount">0</h2>
                    <p>L·ªùi m·ªùi g·ª≠i</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('discover')">
                    üîç Kh√°m ph√°
                </button>
                <button class="tab-btn" onclick="showTab('requests')">
                    üì¨ L·ªùi m·ªùi <span class="badge badge-warning" id="requestsBadge">0</span>
                </button>
                <button class="tab-btn" onclick="showTab('friends')">
                    üë• B·∫°n b√® <span class="badge badge-primary" id="friendsBadge">0</span>
                </button>
                <button class="tab-btn" onclick="showTab('sent')">
                    üì§ ƒê√£ g·ª≠i
                </button>
            </div>

            <!-- Tab contents -->
            <div id="discover" class="tab-content active"></div>
            <div id="requests" class="tab-content"></div>
            <div id="friends" class="tab-content"></div>
            <div id="sent" class="tab-content"></div>
        </div>
    </div>

    <script>
        let currentUser = null;

        // Kh·ªüi t·∫°o: load danh s√°ch user
        async function initUsers() {
            try {
                const res = await fetch('/api/friends/all-users');
                const users = await res.json();
                
                const select = document.getElementById('userSelect');
                select.innerHTML = '<option value="">-- Ch·ªçn t√™n c·ªßa b·∫°n --</option>';
                
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user;
                    option.textContent = user;
                    select.appendChild(option);
                });
                
                // Th√™m option t·∫°o user m·ªõi
                const newOption = document.createElement('option');
                newOption.value = 'NEW_USER';
                newOption.textContent = '‚ûï T·∫°o t√†i kho·∫£n m·ªõi';
                select.appendChild(newOption);
            } catch (e) {
                console.error('L·ªói load users:', e);
            }
        }

        // ƒê·ªïi user
        function changeUser() {
            const select = document.getElementById('userSelect');
            const value = select.value;
            
            if (!value) {
                document.getElementById('mainContent').style.display = 'none';
                return;
            }
            
            if (value === 'NEW_USER') {
                const newUser = prompt('Nh·∫≠p t√™n c·ªßa b·∫°n:');
                if (newUser && newUser.trim()) {
                    currentUser = newUser.trim();
                    // Th√™m user m·ªõi v√†o select
                    const option = document.createElement('option');
                    option.value = currentUser;
                    option.textContent = currentUser;
                    select.insertBefore(option, select.lastElementChild);
                    select.value = currentUser;
                    
                    init();
                } else {
                    select.value = '';
                }
            } else {
                currentUser = value;
                init();
            }
        }

        // Kh·ªüi t·∫°o d·ªØ li·ªáu sau khi ch·ªçn user
        async function init() {
            document.getElementById('mainContent').style.display = 'block';
            await updateStats();
            await renderDiscover();
            await renderRequests();
            await renderFriends();
            await renderSent();
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        async function updateStats() {
            try {
                const res = await fetch(`/api/friends/stats?user=${currentUser}`);
                const data = await res.json();
                document.getElementById('friendsCount').textContent = data.friends || 0;
                document.getElementById('pendingCount').textContent = data.pending || 0;
                document.getElementById('sentCount').textContent = data.sent || 0;
                document.getElementById('requestsBadge').textContent = data.pending || 0;
                document.getElementById('friendsBadge').textContent = data.friends || 0;
            } catch (e) {
                console.error('L·ªói stats:', e);
            }
        }

        // Chuy·ªÉn tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Hi·ªÉn th·ªã ng∆∞·ªùi c√≥ th·ªÉ k·∫øt b·∫°n
        async function renderDiscover() {
            const container = document.getElementById('discover');
            try {
                const res = await fetch(`/api/friends/discover?user=${currentUser}`);
                const users = await res.json();

                if (users.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéâ</div>
                            <h3>ƒê√£ k·∫øt n·ªëi v·ªõi m·ªçi ng∆∞·ªùi!</h3>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = users.map(user => `
                    <div class="user-card">
                        <div class="user-details">
                            <div class="user-avatar">${user.charAt(0).toUpperCase()}</div>
                            <div class="user-info">
                                <h3>${user}</h3>
                                <p>Ng∆∞·ªùi d√πng</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="sendRequest('${user}')">
                            ‚ûï Th√™m b·∫°n
                        </button>
                    </div>
                `).join('');
            } catch (e) {
                console.error('L·ªói discover:', e);
            }
        }

        // Hi·ªÉn th·ªã l·ªùi m·ªùi nh·∫≠n ƒë∆∞·ª£c
        async function renderRequests() {
            const container = document.getElementById('requests');
            try {
                const res = await fetch(`/api/friends/pending?user=${currentUser}`);
                const requests = await res.json();

                if (requests.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <h3>Kh√¥ng c√≥ l·ªùi m·ªùi n√†o</h3>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = requests.map(user => `
                    <div class="user-card">
                        <div class="user-details">
                            <div class="user-avatar">${user.charAt(0).toUpperCase()}</div>
                            <div class="user-info">
                                <h3>${user}</h3>
                                <p>Mu·ªën k·∫øt b·∫°n</p>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="acceptRequest('${user}')">
                                ‚úÖ Ch·∫•p nh·∫≠n
                            </button>
                            <button class="btn btn-danger" onclick="rejectRequest('${user}')">
                                ‚ùå T·ª´ ch·ªëi
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('L·ªói requests:', e);
            }
        }

        // Hi·ªÉn th·ªã b·∫°n b√®
        async function renderFriends() {
            const container = document.getElementById('friends');
            try {
                const res = await fetch(`/api/friends/list?user=${currentUser}`);
                const friends = await res.json();

                if (friends.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üëã</div>
                            <h3>Ch∆∞a c√≥ b·∫°n b√®</h3>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = friends.map(user => `
                    <div class="user-card">
                        <div class="user-details">
                            <div class="user-avatar">${user.charAt(0).toUpperCase()}</div>
                            <div class="user-info">
                                <h3>${user}</h3>
                                <p>B·∫°n b√®</p>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="removeFriend('${user}')">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                `).join('');
            } catch (e) {
                console.error('L·ªói friends:', e);
            }
        }

        // Hi·ªÉn th·ªã l·ªùi m·ªùi ƒë√£ g·ª≠i
        async function renderSent() {
            const container = document.getElementById('sent');
            try {
                const res = await fetch(`/api/friends/sent?user=${currentUser}`);
                const sent = await res.json();

                if (sent.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üì§</div>
                            <h3>Ch∆∞a g·ª≠i l·ªùi m·ªùi</h3>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = sent.map(user => `
                    <div class="user-card">
                        <div class="user-details">
                            <div class="user-avatar">${user.charAt(0).toUpperCase()}</div>
                            <div class="user-info">
                                <h3>${user}</h3>
                                <p>ƒêang ch·ªù...</p>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="cancelRequest('${user}')">
                            ‚ùå H·ªßy
                        </button>
                    </div>
                `).join('');
            } catch (e) {
                console.error('L·ªói sent:', e);
            }
        }

        // G·ª≠i l·ªùi m·ªùi
        async function sendRequest(toUser) {
            try {
                const res = await fetch('/api/friends/send', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ from: currentUser, to: toUser })
                });
                const data = await res.json();
                alert(data.message);
                init();
            } catch (e) {
                alert('C√≥ l·ªói x·∫£y ra!');
            }
        }

        // Ch·∫•p nh·∫≠n l·ªùi m·ªùi
        async function acceptRequest(fromUser) {
            try {
                const res = await fetch('/api/friends/accept', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user: currentUser, from: fromUser })
                });
                const data = await res.json();
                alert(data.message);
                init();
            } catch (e) {
                alert('C√≥ l·ªói x·∫£y ra!');
            }
        }

        // T·ª´ ch·ªëi l·ªùi m·ªùi
        async function rejectRequest(fromUser) {
            try {
                const res = await fetch('/api/friends/reject', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user: currentUser, from: fromUser })
                });
                const data = await res.json();
                alert(data.message);
                init();
            } catch (e) {
                alert('C√≥ l·ªói x·∫£y ra!');
            }
        }

        // X√≥a b·∫°n
        async function removeFriend(friendUser) {
            if (!confirm(`X√≥a ${friendUser} kh·ªèi b·∫°n b√®?`)) return;
            try {
                const res = await fetch('/api/friends/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user: currentUser, friend: friendUser })
                });
                const data = await res.json();
                alert(data.message);
                init();
            } catch (e) {
                alert('C√≥ l·ªói x·∫£y ra!');
            }
        }

        // H·ªßy l·ªùi m·ªùi
        async function cancelRequest(toUser) {
            try {
                const res = await fetch('/api/friends/cancel', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user: currentUser, to: toUser })
                });
                const data = await res.json();
                alert(data.message);
                init();
            } catch (e) {
                alert('C√≥ l·ªói x·∫£y ra!');
            }
        }

        // Kh·ªüi t·∫°o khi load trang
        initUsers();
    </script>
</body>
</html>