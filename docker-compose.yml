services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"  # ← Chỉ expose port này ra ngoài
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend:/usr/share/nginx/html/static:ro
    networks:
      - app-network
    depends_on:
      - flask-backend
      - django-backend
    restart: unless-stopped

  flask-backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    # ❌ BỎ ports - không expose ra ngoài nữa
    volumes:
      - ./backend:/app
      - ./frontend:/frontend
    networks:
      - app-network
    depends_on:
      - django-backend
    restart: unless-stopped

  django-backend:
    build:
      context: ./user_management
      dockerfile: Dockerfile
    # ❌ BỎ ports - không expose ra ngoài nữa
    volumes:
      - ./user_management:/app
      - ./backend:/backend
      - ./frontend:/frontend
    networks:
      - app-network
    restart: unless-stopped
    environment:  # ✅ THÊM phần này
    - PYTHONUNBUFFERED=1  # Tắt buffering Python

networks:
  app-network:
    driver: bridge